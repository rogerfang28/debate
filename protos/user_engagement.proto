syntax = "proto3";

package user_engagement;

enum EngagementAction {
  ENGAGEMENT_ACTION_UNSPECIFIED = 0;
  ACTION_HOME     = 1;  // basically home page / idle
  ACTION_DEBATING = 2;  // currently in a debate
  ACTION_LOGIN    = 3;  // login page
}

message UserEngagement {
  EngagementAction current_action = 1;
  oneof action_info {
    HomeInfo     home_info     = 2;
    DebatingInfo debating_info = 3;
  }
}

message HomeInfo {
  DebateList available_debates = 1; // list of debates user can join
}

message DebateTopic {
    int32 id = 1;
    string topic = 2;
    int32 creator_id = 3;
    bool is_challenge = 4;
    string claim_its_challenging = 5;
}

message DebateList {
    repeated DebateTopic topics = 1;
}

message DebatingInfo {
  int32 debate_id = 1;
  bool is_challenge = 16; // whether the current debate is a challenge debate
  bool modifying_current_claim = 9;
  message ModificationInfo {
    repeated ClaimInfo new_claims = 1;
    repeated LinkInfo new_links = 2;
    repeated int32 deleted_claim_ids = 3;
    repeated int32 deleted_link_ids = 4;
    
  }
  int32 challenged_user_id = 17;
  int32 challenger_user_id = 18;
  ClaimInfo current_claim = 2; // current claim being viewed/argued
  string current_claim_description = 3; // description of the current claim
  ClaimInfo parent_claim = 4;  // parent claim of the current claim
  ClaimInfo root_claim = 5;    // root claim of the debate
  repeated ClaimInfo children_claims = 6; // child claims of the current claim
  repeated LinkInfo links = 7; // links under the current claim
  repeated ChallengeInfo current_challenges = 8; // challenges against the current claim
  message CurrentDebateAction {
    enum ActionType {
      ACTION_TYPE_UNSPECIFIED = 0;
      VIEWING_CLAIM = 1; // normal state
      ADDING_CHILD_CLAIM = 2; // user is adding a claim
      CONNECTING_CLAIMS = 3; // user is connecting claims
      CHALLENGING_CLAIM = 4; // user is challenging the current claim
      EDITING_CLAIM_DESCRIPTION = 5; // user is editing the current claim description
      EDITING_CLAIM = 6; // user is editing the current claim sentence
      REPORTING_CLAIM = 7; // user is reporting the current claim
    }
    ActionType action_type = 1;
  }

  CurrentDebateAction current_debate_action = 11;
  oneof additional_info {
    // could be none
    ConnectingInfo connecting_info = 12; // info about connecting claims
    ChallengingInfo challenging_info = 15; // info about challenging claims
  }

  message ConnectingInfo {
    int32 from_claim_id = 1;
    int32 to_claim_id   = 2;
    string connection = 3;
    bool connecting = 4;
    bool opened_connect_modal = 5;  
  }

  message ChallengingInfo {
    repeated int32 claim_ids = 1; // claim ids to be challenged
    repeated int32 link_ids = 2; // link ids to be challenged
    string challenge_sentence = 3; // sentence for the challenge
    bool opened_challenge_modal = 4;
  }
}

message ClaimInfo {
  int32 id = 1;
  string sentence = 2;
  int32 creator_id = 3;
}

message LinkInfo {
  int32 id = 1;
  int32 connect_from = 2;
  int32 connect_to = 3;
  string connection = 4;  
  int32 creator_id = 5;
}
message ChallengeInfo{
  int32 id = 1;
  string sentence = 2;
  int32 creator_id = 3;
}
